FROM continuumio/miniconda3

# Here we get all python packages.
RUN conda install numpy scikit-learn pandas python-snappy pyarrow scikit-learn-intelex
RUN conda install -c conda-forge dask dask-ml
ENV PYTHONUNBUFFERED=TRUE
ENV PYTHONDONTWRITEBYTECODE=TRUE
ENV PATH="/opt/ml/inference:${PATH}"

# Set up the program in the image
COPY models /opt/ml/models
COPY support /opt/ml/support
COPY inference /opt/ml/inference
WORKDIR /opt/ml/inference

# Here we lambda dependencie
RUN pip install --target /opt/ml/inference awslambdaric
RUN pip install --target /opt/ml/inference git+https://github.com/elastic/ember.git

COPY ./entry_script.sh .
ADD aws-lambda-rie aws-lambda-rie

RUN chmod +x entry_script.sh
RUN chmod +x aws-lambda-rie

ENTRYPOINT [ "/opt/ml/inference/entry_script.sh" ]
CMD [ "inference.handler" ]
